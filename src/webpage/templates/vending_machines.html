{% extends "base.html" %}

{% block title %}Vending Machines - CoffEMAp{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="pt-br"></html>
<head>
    <title>Vending Machines</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='products_style.css') }}">
    <script> 
        // Função para gerenciar máquinas favoritas
        function toggleFavorite(machineId) {
            const checkbox = document.getElementById(`favorite-${machineId}`);
            if (checkbox.checked) {
                favorites.add(machineId);
            } else {
                favorites.delete(machineId);
            }
        }

        // Enviar lista de favoritos para o backend
        function submitFavorites() {
            fetch("{{ url_for('save_favorites') }}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ favorites: Array.from(favorites) } ),
            })
            .then(response => {
                if (response.ok) {
                    alert("Favoritos salvos com sucesso!");
                } else {
                    alert("Erro ao salvar favoritos.");
                }
            });
        }

        const favorites = new Set();
    </script>
</head>
<body>
    <header>
        <div class="top-bar">
            <h1>COFFEMAP</h1>
            <div class="header-options">
                <div class="language-buttons">
                    <button class="active">PT</button>
                    <button>EN</button>
                    <button>ES</button>
                </div>
            </div>
        </div>
        <nav class="navbar">
            <ul> <!-- Menu de navegação -->
                <li><a href="admin_page">Voltar</a></li>
            </ul>
        </nav>
    </header>
    <h1>Avaliar máquinas de venda</h1>
    <div class="container">
        {% for vm in vending_machines %}
        <div class="item">
            <h3>Máquina de venda {{ vm.get_id() }}</h3>
            <p>{{ vm.get_location() }}</p>
            <label>
                <input type="checkbox" id="favorite-{{ vm.get_id() }}" 
                       onchange="toggleFavorite('{{ vm.get_id() }}')" 
                       {% if vm.get_id() in favorites %} checked {% endif %}>
                Favoritar
            </label>
            <button onclick="window.location.href='{{ url_for('products_page', location=vm.get_location()) }}'">Ver produtos</button>
        </div>
        {% endfor %}
    </div>
    <button onclick="submitFavorites()">Salvar Favoritos</button>
    <footer>
        <p>&copy;coffemap</p>
    </footer>
</body>
</html>

{% endblock %}